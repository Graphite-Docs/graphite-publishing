{"version":3,"sources":["../yjs/node_modules/browser-pack/_prelude.js","src/Memory.js","src/RedBlackTree.js"],"names":["f","exports","module","define","amd","g","window","global","self","this","yMemory","e","t","n","r","s","o","u","a","require","i","Error","code","l","call","length","1","extend","Y","Transaction","_Y$Transaction","store","_classCallCheck","_this","_possibleConstructorReturn","__proto__","Object","getPrototypeOf","ss","os","ds","_inherits","Store","utils","RBTree","BufferedStore","createSmallLookupBuffer","Database","_Y$AbstractDatabase","y","opts","_this2","_createClass","key","value","requestTransaction","regeneratorRuntime","mark","_callee","wrap","_context","prev","next","console","log","connector","userId","t0","delegateYield","getStateSet","t2","t1","logTable","gc1","gc2","warn","JSON","stringify","listenersById","listenersByIdExecuteNow","transactionInProgress","stop","makeGen","gen","res","done","getNextRequest","destroy","_context2","_get","prototype","AbstractDatabase","N","val","color","_left","_right","_parent","id","tree","parent","newParent","right","newRight","left","root","p","newLeft","get","set","findNext","findWithLowerBound","abrupt","findPrev","findWithUpperBound","from","smaller","to","_context3","findNodeWithLowerBound","_context4","findNodeWithUpperBound","iterate","_context5","findSmallestNode","compareIds","filter","_context7","o_","_context6","_typeof","push","table","find","_context8","findNode","constructor","Array","_delete","d","isFakeChild","child","_context9","blacken","isBlack","isRed","_fixDelete","node","sibling","redden","rotateLeft","rotateRight","put","v","_context10","_fixInsert","uncle","getUncle","grandparent","flush","_context11"],"mappings":"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","file":"y-memory.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/* global Y */\n'use strict'\n\nfunction extend (Y) {\n  require('./RedBlackTree.js')(Y)\n  class Transaction extends Y.Transaction {\n    constructor (store) {\n      super(store)\n      this.store = store\n      this.ss = store.ss\n      this.os = store.os\n      this.ds = store.ds\n    }\n  }\n  var Store = Y.utils.RBTree\n  var BufferedStore = Y.utils.createSmallLookupBuffer(Store)\n\n  class Database extends Y.AbstractDatabase {\n    constructor (y, opts) {\n      super(y, opts)\n      this.os = new BufferedStore()\n      this.ds = new Store()\n      this.ss = new BufferedStore()\n    }\n    logTable () {\n      var self = this\n      self.requestTransaction(function * () {\n        console.log('User: ', this.store.y.connector.userId, \"==============================\") // eslint-disable-line\n        console.log(\"State Set (SS):\", yield* this.getStateSet()) // eslint-disable-line\n        console.log(\"Operation Store (OS):\") // eslint-disable-line\n        yield* this.os.logTable() // eslint-disable-line\n        console.log(\"Deletion Store (DS):\") //eslint-disable-line\n        yield* this.ds.logTable() // eslint-disable-line\n        if (this.store.gc1.length > 0 || this.store.gc2.length > 0) {\n          console.warn('GC1|2 not empty!', this.store.gc1, this.store.gc2)\n        }\n        if (JSON.stringify(this.store.listenersById) !== '{}') {\n          console.warn('listenersById not empty!')\n        }\n        if (JSON.stringify(this.store.listenersByIdExecuteNow) !== '[]') {\n          console.warn('listenersByIdExecuteNow not empty!')\n        }\n        if (this.store.transactionInProgress) {\n          console.warn('Transaction still in progress!')\n        }\n      }, true)\n    }\n    transact (makeGen) {\n      var t = new Transaction(this)\n      while (makeGen !== null) {\n        var gen = makeGen.call(t)\n        var res = gen.next()\n        while (!res.done) {\n          res = gen.next(res.value)\n        }\n        makeGen = this.getNextRequest()\n      }\n    }\n    * destroy () {\n      yield* super.destroy()\n      delete this.os\n      delete this.ss\n      delete this.ds\n    }\n  }\n  Y.extend('memory', Database)\n}\n\nmodule.exports = extend\nif (typeof Y !== 'undefined') {\n  extend(Y)\n}\n","'use strict'\n\n/*\n  This file contains a not so fancy implemantion of a Red Black Tree.\n*/\nmodule.exports = function (Y) {\n  class N {\n    // A created node is always red!\n    constructor (val) {\n      this.val = val\n      this.color = true\n      this._left = null\n      this._right = null\n      this._parent = null\n      if (val.id === null) {\n        throw new Error('You must define id!')\n      }\n    }\n    isRed () { return this.color }\n    isBlack () { return !this.color }\n    redden () { this.color = true; return this }\n    blacken () { this.color = false; return this }\n    get grandparent () {\n      return this.parent.parent\n    }\n    get parent () {\n      return this._parent\n    }\n    get sibling () {\n      return (this === this.parent.left)\n        ? this.parent.right : this.parent.left\n    }\n    get left () {\n      return this._left\n    }\n    get right () {\n      return this._right\n    }\n    set left (n) {\n      if (n !== null) {\n        n._parent = this\n      }\n      this._left = n\n    }\n    set right (n) {\n      if (n !== null) {\n        n._parent = this\n      }\n      this._right = n\n    }\n    rotateLeft (tree) {\n      var parent = this.parent\n      var newParent = this.right\n      var newRight = this.right.left\n      newParent.left = this\n      this.right = newRight\n      if (parent === null) {\n        tree.root = newParent\n        newParent._parent = null\n      } else if (parent.left === this) {\n        parent.left = newParent\n      } else if (parent.right === this) {\n        parent.right = newParent\n      } else {\n        throw new Error('The elements are wrongly connected!')\n      }\n    }\n    next () {\n      if (this.right !== null) {\n        // search the most left node in the right tree\n        var o = this.right\n        while (o.left !== null) {\n          o = o.left\n        }\n        return o\n      } else {\n        var p = this\n        while (p.parent !== null && p !== p.parent.left) {\n          p = p.parent\n        }\n        return p.parent\n      }\n    }\n    prev () {\n      if (this.left !== null) {\n        // search the most right node in the left tree\n        var o = this.left\n        while (o.right !== null) {\n          o = o.right\n        }\n        return o\n      } else {\n        var p = this\n        while (p.parent !== null && p !== p.parent.right) {\n          p = p.parent\n        }\n        return p.parent\n      }\n    }\n    rotateRight (tree) {\n      var parent = this.parent\n      var newParent = this.left\n      var newLeft = this.left.right\n      newParent.right = this\n      this.left = newLeft\n      if (parent === null) {\n        tree.root = newParent\n        newParent._parent = null\n      } else if (parent.left === this) {\n        parent.left = newParent\n      } else if (parent.right === this) {\n        parent.right = newParent\n      } else {\n        throw new Error('The elements are wrongly connected!')\n      }\n    }\n    getUncle () {\n      // we can assume that grandparent exists when this is called!\n      if (this.parent === this.parent.parent.left) {\n        return this.parent.parent.right\n      } else {\n        return this.parent.parent.left\n      }\n    }\n  }\n\n  class RBTree {\n    constructor () {\n      this.root = null\n      this.length = 0\n    }\n    * findNext (id) {\n      return yield* this.findWithLowerBound([id[0], id[1] + 1])\n    }\n    * findPrev (id) {\n      return yield* this.findWithUpperBound([id[0], id[1] - 1])\n    }\n    findNodeWithLowerBound (from) {\n      if (from === void 0) {\n        throw new Error('You must define from!')\n      }\n      var o = this.root\n      if (o === null) {\n        return null\n      } else {\n        while (true) {\n          if ((from === null || Y.utils.smaller(from, o.val.id)) && o.left !== null) {\n            // o is included in the bound\n            // try to find an element that is closer to the bound\n            o = o.left\n          } else if (from !== null && Y.utils.smaller(o.val.id, from)) {\n            // o is not within the bound, maybe one of the right elements is..\n            if (o.right !== null) {\n              o = o.right\n            } else {\n              // there is no right element. Search for the next bigger element,\n              // this should be within the bounds\n              return o.next()\n            }\n          } else {\n            return o\n          }\n        }\n      }\n    }\n    findNodeWithUpperBound (to) {\n      if (to === void 0) {\n        throw new Error('You must define from!')\n      }\n      var o = this.root\n      if (o === null) {\n        return null\n      } else {\n        while (true) {\n          if ((to === null || Y.utils.smaller(o.val.id, to)) && o.right !== null) {\n            // o is included in the bound\n            // try to find an element that is closer to the bound\n            o = o.right\n          } else if (to !== null && Y.utils.smaller(to, o.val.id)) {\n            // o is not within the bound, maybe one of the left elements is..\n            if (o.left !== null) {\n              o = o.left\n            } else {\n              // there is no left element. Search for the prev smaller element,\n              // this should be within the bounds\n              return o.prev()\n            }\n          } else {\n            return o\n          }\n        }\n      }\n    }\n    findSmallestNode () {\n      var o = this.root\n      while (o != null && o.left != null) {\n        o = o.left\n      }\n      return o\n    }\n    * findWithLowerBound (from) {\n      var n = this.findNodeWithLowerBound(from)\n      return n == null ? null : n.val\n    }\n    * findWithUpperBound (to) {\n      var n = this.findNodeWithUpperBound(to)\n      return n == null ? null : n.val\n    }\n    * iterate (t, from, to, f) {\n      var o\n      if (from === null) {\n        o = this.findSmallestNode()\n      } else {\n        o = this.findNodeWithLowerBound(from)\n      }\n      while (o !== null && (to === null || Y.utils.smaller(o.val.id, to) || Y.utils.compareIds(o.val.id, to))) {\n        yield* f.call(t, o.val)\n        o = o.next()\n      }\n      return true\n    }\n    * logTable (from, to, filter) {\n      if (filter == null) {\n        filter = function () {\n          return true\n        }\n      }\n      if (from == null) { from = null }\n      if (to == null) { to = null }\n      var os = []\n      yield* this.iterate(this, from, to, function * (o) {\n        if (filter(o)) {\n          var o_ = {}\n          for (var key in o) {\n            if (typeof o[key] === 'object') {\n              o_[key] = JSON.stringify(o[key])\n            } else {\n              o_[key] = o[key]\n            }\n          }\n          os.push(o_)\n        }\n      })\n      if (console.table != null) {\n        console.table(os)\n      }\n    }\n    * find (id) {\n      var n\n      return (n = this.findNode(id)) ? n.val : null\n    }\n    findNode (id) {\n      if (id == null || id.constructor !== Array) {\n        throw new Error('Expect id to be an array!')\n      }\n      var o = this.root\n      if (o === null) {\n        return false\n      } else {\n        while (true) {\n          if (o === null) {\n            return false\n          }\n          if (Y.utils.smaller(id, o.val.id)) {\n            o = o.left\n          } else if (Y.utils.smaller(o.val.id, id)) {\n            o = o.right\n          } else {\n            return o\n          }\n        }\n      }\n    }\n    * delete (id) {\n      if (id == null || id.constructor !== Array) {\n        throw new Error('id is expected to be an Array!')\n      }\n      var d = this.findNode(id)\n      if (d == null) {\n        // throw new Error('Element does not exist!')\n        return\n      }\n      this.length--\n      if (d.left !== null && d.right !== null) {\n        // switch d with the greates element in the left subtree.\n        // o should have at most one child.\n        var o = d.left\n        // find\n        while (o.right !== null) {\n          o = o.right\n        }\n        // switch\n        d.val = o.val\n        d = o\n      }\n      // d has at most one child\n      // let n be the node that replaces d\n      var isFakeChild\n      var child = d.left || d.right\n      if (child === null) {\n        isFakeChild = true\n        child = new N({id: 0})\n        child.blacken()\n        d.right = child\n      } else {\n        isFakeChild = false\n      }\n\n      if (d.parent === null) {\n        if (!isFakeChild) {\n          this.root = child\n          child.blacken()\n          child._parent = null\n        } else {\n          this.root = null\n        }\n        return\n      } else if (d.parent.left === d) {\n        d.parent.left = child\n      } else if (d.parent.right === d) {\n        d.parent.right = child\n      } else {\n        throw new Error('Impossible!')\n      }\n      if (d.isBlack()) {\n        if (child.isRed()) {\n          child.blacken()\n        } else {\n          this._fixDelete(child)\n        }\n      }\n      this.root.blacken()\n      if (isFakeChild) {\n        if (child.parent.left === child) {\n          child.parent.left = null\n        } else if (child.parent.right === child) {\n          child.parent.right = null\n        } else {\n          throw new Error('Impossible #3')\n        }\n      }\n    }\n    _fixDelete (n) {\n      function isBlack (node) {\n        return node !== null ? node.isBlack() : true\n      }\n      function isRed (node) {\n        return node !== null ? node.isRed() : false\n      }\n      if (n.parent === null) {\n        // this can only be called after the first iteration of fixDelete.\n        return\n      }\n      // d was already replaced by the child\n      // d is not the root\n      // d and child are black\n      var sibling = n.sibling\n      if (isRed(sibling)) {\n        // make sibling the grandfather\n        n.parent.redden()\n        sibling.blacken()\n        if (n === n.parent.left) {\n          n.parent.rotateLeft(this)\n        } else if (n === n.parent.right) {\n          n.parent.rotateRight(this)\n        } else {\n          throw new Error('Impossible #2')\n        }\n        sibling = n.sibling\n      }\n      // parent, sibling, and children of n are black\n      if (n.parent.isBlack() &&\n        sibling.isBlack() &&\n        isBlack(sibling.left) &&\n        isBlack(sibling.right)\n      ) {\n        sibling.redden()\n        this._fixDelete(n.parent)\n      } else if (n.parent.isRed() &&\n        sibling.isBlack() &&\n        isBlack(sibling.left) &&\n        isBlack(sibling.right)\n      ) {\n        sibling.redden()\n        n.parent.blacken()\n      } else {\n        if (n === n.parent.left &&\n          sibling.isBlack() &&\n          isRed(sibling.left) &&\n          isBlack(sibling.right)\n        ) {\n          sibling.redden()\n          sibling.left.blacken()\n          sibling.rotateRight(this)\n          sibling = n.sibling\n        } else if (n === n.parent.right &&\n          sibling.isBlack() &&\n          isRed(sibling.right) &&\n          isBlack(sibling.left)\n        ) {\n          sibling.redden()\n          sibling.right.blacken()\n          sibling.rotateLeft(this)\n          sibling = n.sibling\n        }\n        sibling.color = n.parent.color\n        n.parent.blacken()\n        if (n === n.parent.left) {\n          sibling.right.blacken()\n          n.parent.rotateLeft(this)\n        } else {\n          sibling.left.blacken()\n          n.parent.rotateRight(this)\n        }\n      }\n    }\n    * put (v) {\n      if (v == null || v.id == null || v.id.constructor !== Array) {\n        throw new Error('v is expected to have an id property which is an Array!')\n      }\n      var node = new N(v)\n      if (this.root !== null) {\n        var p = this.root // p abbrev. parent\n        while (true) {\n          if (Y.utils.smaller(node.val.id, p.val.id)) {\n            if (p.left === null) {\n              p.left = node\n              break\n            } else {\n              p = p.left\n            }\n          } else if (Y.utils.smaller(p.val.id, node.val.id)) {\n            if (p.right === null) {\n              p.right = node\n              break\n            } else {\n              p = p.right\n            }\n          } else {\n            p.val = node.val\n            return p\n          }\n        }\n        this._fixInsert(node)\n      } else {\n        this.root = node\n      }\n      this.length++\n      this.root.blacken()\n      return node\n    }\n    _fixInsert (n) {\n      if (n.parent === null) {\n        n.blacken()\n        return\n      } else if (n.parent.isBlack()) {\n        return\n      }\n      var uncle = n.getUncle()\n      if (uncle !== null && uncle.isRed()) {\n        // Note: parent: red, uncle: red\n        n.parent.blacken()\n        uncle.blacken()\n        n.grandparent.redden()\n        this._fixInsert(n.grandparent)\n      } else {\n        // Note: parent: red, uncle: black or null\n        // Now we transform the tree in such a way that\n        // either of these holds:\n        //   1) grandparent.left.isRed\n        //     and grandparent.left.left.isRed\n        //   2) grandparent.right.isRed\n        //     and grandparent.right.right.isRed\n        if (n === n.parent.right && n.parent === n.grandparent.left) {\n          n.parent.rotateLeft(this)\n          // Since we rotated and want to use the previous\n          // cases, we need to set n in such a way that\n          // n.parent.isRed again\n          n = n.left\n        } else if (n === n.parent.left && n.parent === n.grandparent.right) {\n          n.parent.rotateRight(this)\n          // see above\n          n = n.right\n        }\n        // Case 1) or 2) hold from here on.\n        // Now traverse grandparent, make parent a black node\n        // on the highest level which holds two red nodes.\n        n.parent.blacken()\n        n.grandparent.redden()\n        if (n === n.parent.left) {\n          // Case 1\n          n.grandparent.rotateRight(this)\n        } else {\n          // Case 2\n          n.grandparent.rotateLeft(this)\n        }\n      }\n    }\n    * flush () {}\n  }\n\n  Y.utils.RBTree = RBTree\n}\n"]}